import unittest
from src.business_logic import (
    find_patron_by_name,
    find_patron_by_age,
    find_patron_by_name_and_age,
    find_item_by_id,
)

# Minimal helper classes used for testing
class Patron:
    """A lightweight Patron stub with only the attributes needed."""
    def __init__(self, name, age):
        self._name = name
        self._age = age


class Item:
    """A lightweight Item stub with only an _id field."""
    def __init__(self, item_id):
        self._id = item_id


class TestFindFunctionsFull(unittest.TestCase):
    """Comprehensive tests for all four 'find_' helper functions."""

    def setUp(self):
        # Sample patrons and catalogue items
        self.patrons = [
            Patron("Alex", 18),
            Patron("alex", 25),
            Patron("Bella", 25),
            Patron("Chris", 90),
        ]
        self.items = [Item(1), Item(2), Item(5)]

    # ---------- find_patron_by_name ----------
    def test_find_patron_by_name_exact_match(self):
        """Should return every patron whose name exactly matches the input."""
        result = find_patron_by_name("Alex", self.patrons)
        # Implementation is case-sensitive, so only the capitalised one is found
        self.assertEqual(len(result), 1)
        self.assertEqual(result[0]._name, "Alex")

    def test_find_patron_by_name_no_match(self):
        """Should return an empty list when the name does not exist."""
        result = find_patron_by_name("Dana", self.patrons)
        self.assertEqual(result, [])

    # ---------- find_patron_by_age ----------
    def test_find_patron_by_age_multiple(self):
        """Should return all patrons of the same age."""
        result = find_patron_by_age(25, self.patrons)
        self.assertEqual({p._name for p in result}, {"alex", "Bella"})

    def test_find_patron_by_age_none(self):
        """Should return an empty list when no ages match."""
        self.assertEqual(find_patron_by_age(7, self.patrons), [])

    # ---------- find_patron_by_name_and_age ----------
    def test_find_patron_by_name_and_age_case_insensitive(self):
        """
        Uses .lower(), so should match regardless of case.
        'Alex' in data should match lowercase search.
        """
        result = find_patron_by_name_and_age("alex", 18, self.patrons)
        self.assertIsNotNone(result)
        self.assertEqual(result._name, "Alex")

    def test_find_patron_by_name_and_age_not_found(self):
        """Should return None when the (name, age) pair does not exist."""
        result = find_patron_by_name_and_age("Chris", 25, self.patrons)
        self.assertIsNone(result)

    # ---------- find_item_by_id ----------
    def test_find_item_by_id_found(self):
        """Should return the correct item object when ID exists."""
        result = find_item_by_id(5, self.items)
        self.assertIsNotNone(result)
        self.assertEqual(result._id, 5)

    def test_find_item_by_id_not_found(self):
        """Should return None when no item has the given ID."""
        self.assertIsNone(find_item_by_id(999, self.items))


